{"name":"iKan","tagline":"Simple visual task board","body":"#iKan\r\n----\r\n![ikan_logo](http://s22.postimg.org/jmufttie9/ic_launcher.png)\r\n##Introduction\r\n**iKan is a Construction site managment which implements the basic principles of [Lean construction](https://en.wikipedia.org/wiki/Lean_construction). the Project focuses on Kanban methodology, and to optimize the team work in the construction site and to save work time and make the steps of the work easier and cleaner.**\r\n###What is Kanban?\r\nKanban is a methodology originally developed by Toyota to be more efficient.\r\n\r\nThere is only two constraints imposed by Kanban:\r\n\r\n- Visualize your workflow\r\n- Limit your work in progress\r\n- Continuous flow\r\n- Changes can be made at anytime\r\n- Kanban board is persistent\r\n\r\n\r\n\r\n##iKan project\r\nthe project contains two main apps:\r\n\r\n###Managment website:\r\nThis system is based on an opensource project called [Kanboard](https://github.com/fguillot/kanboard), which has basic functionality like: Kanban board, Creating tasks and project, Calendar ect...\r\n\r\niKan is a customized version of [Kanboard](https://github.com/fguillot/kanboard), for the purpose of adapting it to the construction site managment needs.\r\n###Main Features:\r\n\r\n####Construction Trade:\r\n\r\nFor each project the Adimistrator/Project Manager can add/edit the list of Construction Trades that are participating in the project.\r\n![construction_trade](http://i.imgur.com/RRKSFbq.png)\r\n####Spaces:\r\nFor each project the Adimistrator/Project Manager can add a heirarchy of the spaces in the project\r\n![spaces](http://i.imgur.com/WeDN6Qv.png)\r\n> * To add an abbreviation to Spaces that have childen, type between parentheses.\r\n> * Use @ sign to indicate that the space is for notation only and cannot be assosiated with any task\r\n\r\n> Spaces are presisted as a json string inside Projects Table, in order to display the heirarchy and to save the json, we Serialize and deSerialize the json object of this structure:\r\n\r\n** Load and Save Spaces Methods **\r\n\r\n```\r\nfunction load_Spaces() {\r\n\tvar sp = $(\"#demo\").attr(\"data-spaces\");\r\n    console.log('spaces:' + sp);\r\n    var data;\r\n    if (sp.length == 0) {\r\n        data = {name: \"Spaces\"};\r\n    } else {\r\n        data = JSON.parse(sp);\r\n    }\r\n}\r\n\r\n$(\"#save\").click(function () {\r\n        console.log('save' + JSON.stringify(demo.$data.treeData));\r\n        $.ajax({\r\n            cache: false,\r\n            url: $(\"#demo\").attr(\"data-save-url\"),\r\n            contentType: \"application/json\",\r\n            type: \"POST\",\r\n            processData: false,\r\n            data: JSON.stringify({\r\n                \"project_id\": $(\"#demo\").attr(\"data-project-id\"),\r\n                \"spaces\":JSON.stringify(demo.$data.treeData)\r\n            }),\r\n            success: function(spaces) {\r\n                //data = spaces;\r\n                alert('Saved spaces')\r\n                console.log('data saved');\r\n            }\r\n        });\r\n    });\r\n```\r\n** Spaces Data Object **\r\n\r\n\r\n```\r\n{\r\n  \"name\": \"Spaces\",\r\n  \"children\": [\r\n    {\r\n      \"name\": \"Level -1 - Parking\"\r\n    },\r\n    {\r\n      \"name\": \"Level 0 - Lobby\"\r\n    },\r\n    {\r\n      \"name\": \"@Level 1 (L1)\",\r\n      \"children\": [\r\n        {\r\n          \"name\": \"NE 3 Rooms Apt (NE3RMs)\",\r\n          \"children\": [\r\n            {\r\n              \"name\": \"Living Room\"\r\n            },\r\n            {\r\n              \"name\": \"Master Bedroom\"\r\n            },\r\n            {\r\n              \"name\": \"Children Bedroom\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"name\": \"NW 4 Rooms Apt (NW4RMs)\",\r\n          \"children\": [\r\n            {\r\n              \"name\": \"Living Room\"\r\n            },\r\n            {\r\n              \"name\": \"Master Bedroom\"\r\n            },\r\n            {\r\n              \"name\": \"Children Bedroom A\"\r\n            },\r\n            {\r\n              \"name\": \"Children Bedroom B\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"name\": \"SW 4 Rooms Apt (SW4RMs)\",\r\n          \"children\": [\r\n            {\r\n              \"name\": \"Living Room\"\r\n            },\r\n            {\r\n              \"name\": \"Master Bedroom\"\r\n            },\r\n            {\r\n              \"name\": \"Children Bedroom A\"\r\n            },\r\n            {\r\n              \"name\": \"Children Bedroom B\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"name\": \"SE 3 Rooms Apt (SE3RMs)\",\r\n          \"children\": [\r\n            {\r\n              \"name\": \"Living Room\"\r\n            },\r\n            {\r\n              \"name\": \"Master Bedroom\"\r\n            },\r\n            {\r\n              \"name\": \"Children Bedroom\"\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    }\r\n  ]\r\n}\r\n```\r\n####Links:\r\nTasks can be linked together with predefined relationships:\r\n\r\nThe Administrator can edit list of Links/Relations between Tasks\r\n\r\n> Material links cannot be removed since they are part of the system\r\n\r\n\r\n![links](http://i.imgur.com/HkzoFFY.png)\r\n\r\n####Creating new Tasks:\r\nThe Admin/Project manager can create new tasks by specifying:\r\n\r\n1. title\r\n2. Description (Markdown Text)\r\n3. Choose Assignee\r\n4. Selecting Spaces that needs to create Tasks (one task per space) [^1] , [^2]\r\n5. Materials should be added with comma separation, example : Asphalt, Sand, Water\r\n6. Color, Time Estimate, Due Date\r\n\r\n![new_task](http://i.imgur.com/aPbQ1XW.png)\r\n\r\n** Parsing Spaces **\r\n\r\n Parse Spaces Json and getting list of Spaces with Abbreviated Path (handeling @ signs, Trimming spaces), using ** Recursive method **\r\n\r\n```\r\n    function recursive_spaces_walkthrough ($array, $level, &$new_array, $path){\r\n        if (empty($array)) {\r\n            return;\r\n        }\r\n        $aabreviation = '';\r\n        foreach($array as $key => $value){\r\n            //If $value is an array.\r\n            if(is_array($value)){\r\n            \t// walkthrough its children\r\n                $this->recursive($value, $level + 1, $new_array, $path . $aabreviation);\r\n            } else {\r\n                if ($level == 0) {\r\n                    // Default Space\r\n                    $new_array[$value] = $value;\r\n                    continue;\r\n                }\r\n                //It is not an array, so print it out.\r\n               //Check if Space name has Abbreviation in Parentheses ().\r\n               if (preg_match('/\\(([A-Za-z0-9 ]+?)\\)/', $value, $matches)) {\r\n                    $aabreviation = $level == 1 ? trim($matches[1]) : '.' . trim($matches[1]);\r\n                } else {\r\n                    $aabreviation = $level == 1 ? trim(str_replace('@','',$value)) : '.' . trim(str_replace('@','',$value));\r\n                }\r\n\r\n                if ($value[0] != '@') {\r\n                    $newString = $path . '.' . trim(preg_replace('/\\(([^()]*+|(?R))*\\)\\s*/', '', $value));\r\n                    $newString = ltrim($newString, '.');\r\n                    $new_array[$newString] = $newString;\r\n                }\r\n            }\r\n        }\r\n    }\r\n```\r\n\r\n** Saving new Task **\r\n\r\n\r\n<pre>\r\n/**\r\n     * Validate and save a new task\r\n     *\r\n     * @access public\r\n     */\r\n    public function save()\r\n    {\r\n        $project = $this->getProject();\r\n        $values = $this->request->getValues();\r\n\r\n        list($valid, $errors) = $this->taskValidator->validateCreation($values);\r\n\r\n        if ($valid) {\r\n            // ikan\r\n            // if \"all spaces\" is selected: create tasks for all the spaces\r\n            if (in_array(self::ALL_SPACES, $values['spaces'])) {\r\n\r\n                $space_list = array();\r\n             $this->taskFinder->recursive(json_decode($this->project->getSpaces($project['id']), true),\r\n              0, $space_list, \"\");\r\n                if (count($space_list) == 0) {\r\n                    $this->createSingleTask($values, $project);\r\n                } else {\r\n                    $output = print_r($space_list,1);\r\n                    error_log($output);\r\n                    foreach ($space_list as $space_name) {\r\n                        $values['spaces'] = $space_name;\r\n                        $temp_title = $values['title'];\r\n                        $values['title'] .= ' - ' . str_replace('_', '', $space_name);\r\n                        $this->createSingleTask($values, $project);\r\n                        $values['title'] = $temp_title;\r\n                    }\r\n                }\r\n            } else {<b>\r\n            // for each one of the selected spaces create Task\r\n                foreach ($values['spaces'] as $selectedOption) {\r\n                    $values['spaces'] = $selectedOption;\r\n                    $temp_title = $values['title'];\r\n                    $values['title'] .= ' - ' . $selectedOption;\r\n                    $this->createSingleTask($values, $project);\r\n                    $values['title'] = $temp_title;\r\n                }</b>\r\n            }\r\n            .\r\n            .\r\n            .\r\n        }\r\n        $this->create($values, $errors);\r\n    }\r\n</pre>\r\n\r\n<pre>\r\nprivate function createSingleTask($values, $project)\r\n    {\r\n        $materialTaskId = 0;\r\n        <b>// if the task requires materials</b>\r\n        if (!empty($values['materials'])) {\r\n            <b>// get Materials Category id</b>\r\n            global $materialCatId;\r\n            $materialCatId = $this->category->getIdByName($values['project_id'], 'Materials');\r\n            if ($materialCatId == 0 ) {\r\n                // if not exist create Material Category\r\n                $materialCatId = (int) $this->category->create(array(\r\n                    'project_id' => $values['project_id'],\r\n                    'name' => 'Materials',\r\n                ));\r\n            }\r\n            <b>// Create Material Task</b>\r\n            $materialTaskValues = array(\r\n                'title' => 'Materials - ' . $values['title'],\r\n                'project_id' => $values['project_id'],\r\n                'color_id' => '',\r\n                'column_id' => 0,\r\n                'owner_id' => 0,\r\n                'creator_id' => $values['creator_id'],\r\n                'date_due' => '',\r\n                'description' => '',\r\n                'category_id' => $materialCatId,\r\n                'spaces' => $values['spaces'],\r\n                'score' => 0,\r\n                'swimlane_id' => $values['swimlane_id'],\r\n            );\r\n            $materialTaskId = $this->taskCreation->create($materialTaskValues);\r\n            <b>// Create Materials subtasks</b>\r\n            $materials = explode(',', $values['materials']);\r\n            foreach ($materials as $key => $val) {\r\n\r\n                $subTask = array(\r\n                    'title' => trim($val),\r\n                    'task_id' => $materialTaskId,\r\n                    'user_id' => 0,\r\n                    'time_estimated' => 0,\r\n                    'time_spent' => 0,\r\n                    'status' => 0,\r\n                );\r\n                $this->subtask->create($subTask);\r\n            }\r\n        }\r\n        unset($values['materials']);\r\n        $originalTask = $this->taskCreation->create($values);\r\n        if ($originalTask) {\r\n            <b>// link material task with original task</b>\r\n            if ($materialTaskId != 0) {\r\n                $this->taskLink->create($materialTaskId, $originalTask, 9);\r\n            }\r\n            $this->session->flash(t('Task created successfully.'));\r\n            return true;\r\n        } else {\r\n            $this->session->flashError(t('Unable to create your task.'));\r\n            return false;\r\n        }\r\n</pre>\r\n\r\n> For each Space a Task will be created with a link to a new Material task with list of materials as Subtasks.\r\n\r\n[^1]:you can select one or more space by holding on Ctrl key or Shift key\r\n[^2]:When selecting \"All Spaces\" option it will create tasks for all \r\n![link](http://i.imgur.com/N96sIbq.png)\r\n![link](http://i.imgur.com/gvxrwZy.png)\r\n\r\n\r\n####Board:\r\n\r\niKan uses Kanban Board to display its Tasks and Ikan devides the board into multiple Swimlane, each swimplane contains one Construction trade\r\n![link](http://i.imgur.com/OlqtEFp.png)\r\n\r\n**clicing on Actions -> Collapse Tasks will display the tasks collapsed**\r\n\r\n![link](http://i.imgur.com/ko9OzdZ.png)\r\n\r\n**Code snippet for loading board by Construction Trade/Categories**\r\n<pre>\r\n/**\r\n     * Show a board for a given project\r\n     *\r\n     * @access public\r\n     */\r\n    public function show()\r\n    {\r\n        $params = $this->getProjectFilters('board', 'show');\r\n        // ikan swimlanes becomes Construction Trade\r\n        $this->response->html($this->template->layout('board/private_view', array(\r\n            'categories_list' => $this->category->getList($params['project']['id'], false),\r\n            'users_list' => $this->projectPermission->getMemberList($params['project']['id'], false),\r\n            'swimlanes' => $this->taskFilter->search($params['filters']['search'])\r\n            \t\t\t\t<b>->getBoardByTradeSwimlanes($params['project']['id']),</b>\r\n            'description' => $params['project']['description'],\r\n            'board_private_refresh_interval' => $this->config->get('board_private_refresh_interval'),\r\n            'board_highlight_period' => $this->config->get('board_highlight_period'),\r\n        ) + $params));\r\n    }\r\n    \r\n    public function <b>getBoardByTradeSwimlanes($project_id)</b>\r\n    {\r\n        $tasks = $this->filterByProject($project_id)->query->asc(Task::TABLE.'.position')->findAll();\r\n\r\n        <b>return $this->board->getBoardByTradeSwimlanes($project_id, \r\n        \tfunction ($project_id, $column_id, $swimlane_id) use ($tasks) {\r\n            \treturn array_filter($tasks, function(array $task) use ($column_id, $swimlane_id) {\r\n                \treturn $task['column_id'] == $column_id && $task['category_id'] == $swimlane_id;\r\n            \t\r\n            \t});\r\n        });</b>\r\n    }\r\n    \r\n    public function <b>getBoardByTradeSwimlanes($project_id, $callback = null)</b>\r\n    {\r\n        $trades = $this->category->getAll($project_id);\r\n        $columns = $this->getColumns($project_id);\r\n        $nb_columns = count($columns);\r\n\r\n        for ($i = 0, $ilen = count($trades); $i < $ilen; $i++) {\r\n            $trades[$i]['columns'] = $columns;\r\n            $trades[$i]['nb_columns'] = $nb_columns;\r\n            $trades[$i]['nb_tasks'] = 0;\r\n\r\n            for ($j = 0; $j < $nb_columns; $j++) {\r\n                $column_id = $columns[$j]['id'];\r\n                $trades_id = $trades[$i]['id'];\r\n\r\n                <b>$trades[$i]['columns'][$j]['tasks'] = $callback === null ? $this->taskFinder\r\n                \t->getTasksByColumnAndCategory($project_id, $columns[$j]['id'], $trades[$i]['id'])\r\n                \t : $callback($project_id, $column_id, $trades_id);</b>\r\n                $trades[$i]['columns'][$j]['nb_tasks'] = count($trades[$i]['columns'][$j]['tasks']);\r\n                $trades[$i]['nb_tasks'] += $trades[$i]['columns'][$j]['nb_tasks'];\r\n            }\r\n        }\r\n\r\n        return $trades;\r\n    }\r\n    \r\n    public function getTasksByColumnAndCategory($project_id, $column_id, $category_id)\r\n    {\r\n        return $this->getExtendedQuery()\r\n            ->eq(Task::TABLE.'.project_id', $project_id)\r\n            ->eq(Task::TABLE.'.column_id', $column_id)\r\n            ->eq(Task::TABLE.'.category_id', $category_id)\r\n            ->eq(Task::TABLE.'.is_active', Task::STATUS_OPEN)\r\n            ->asc('tasks.position')\r\n            ->findAll();\r\n    }\r\n</pre>\r\n\r\n####Gantt\r\n\r\n![gntt](http://i.imgur.com/XrrG6Hv.png)","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}